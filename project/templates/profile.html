{% extends "base.html" %}

{% block content %}
<h1 class="title">
  Welcome, {{ user.name if user and user.name else (user.email if user and user.email else 'digIT User') }}!
</h1>

{% if user %}
<div class="content">
  <h2>Profile Information</h2>
  
  <!-- Basic user info -->
  {% if user.sub %}
  <p><strong>User ID:</strong> {{ user.sub }}</p>
  {% endif %}
  
  {% if user.name %}
  <p><strong>Name:</strong> {{ user.name }}</p>
  {% endif %}
  
  {% if user.email %}
  <p><strong>Email:</strong> {{ user.email }}</p>
  {% endif %}
  
  {% if user.nick %}
  <p><strong>Nickname:</strong> {{ user.nick }}</p>
  {% endif %}
  
  {% if user.cid %}
  <p><strong>CID:</strong> {{ user.cid }}</p>
  {% endif %}

    <!-- Active Groups -->
  {% if user.groups %}
  <p><strong>Active Groups:</strong>
    {% for group in user.groups %}
      {{ group.name }}{% if group.post %} ({{ group.post }}){% endif %}{% if not loop.last %}, {% endif %}
    {% endfor %}
  </p>
  {% endif %}

  <!-- OAuth scopes info -->
  {% if user.scopes %}
  <p><strong>OAuth Scopes:</strong> {{ user.scopes }}</p>
  {% endif %}

  <!-- Debug: Show all available user data -->
  <details style="margin-top: 2rem;">
    <summary><strong>Raw User Data (Debug)</strong></summary>
    <pre style="background: #f5f5f5; padding: 1rem; margin-top: 1rem; white-space: pre-wrap;">{{ user | tojson(indent=2) }}</pre>
  </details>

  <!-- Logout button -->
  <div style="margin-top: 2rem;">
    <a class="button is-light" href="{{ url_for('auth.logout') }}">Logout</a>
  </div>
</div>
{% else %}
<div class="content">
  <p>You are not logged in.</p>
  <a class="button is-primary" href="{{ url_for('auth.login') }}">Login</a>
</div>
{% endif %}
{% endblock %}